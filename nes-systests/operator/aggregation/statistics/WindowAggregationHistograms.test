# name: window/synopsis/WindowAggregationHistograms.test
# description: Test different sampling types
# groups: [Synopsis, Aggregation, WindowOperators]

CREATE LOGICAL SOURCE stream(id UINT64, value UINT64, timestamp UINT64);
CREATE PHYSICAL SOURCE FOR stream TYPE File;
ATTACH INLINE
1,1,1000
12,1,1001
4,1,1002
1,2,2000
11,2,2001
16,2,2002
1,3,3000
11,3,3001
1,3,3003
1,3,3200
1,4,4000
1,5,5000
1,6,6000
1,7,7000
1,8,8000
1,9,9000
1,10,10000
1,11,11000
1,12,12000
1,13,13000
1,14,14000
1,15,15000
1,16,16000
1,17,17000
1,18,18000
1,19,19000
1,20,20000
1,21,21000

CREATE SINK sinkStream(stream.statisticStart UINT64, stream.statisticEnd UINT64, stream.bucketKey UINT64, stream.bucketValue UINT64) TYPE File;
CREATE SINK sinkStreamBuild(stream.statisticHash UINT64, stream.statisticStart UINT64, stream.statisticEnd UINT64, stream.statisticNumberOfSeenTuples UINT64) TYPE File;

# Solely build operator
SELECT EQUIWIDTHHISTOGRAM(44, value, 5, 0, 25) FROM stream WINDOW TUMBLING(timestamp, size 5 sec) INTO sinkStreamBuild;
----
44 0 5000 11
44 10000 15000 5
44 15000 20000 5
44 20000 25000 2
44 5000 10000 5

# Simple equi width histogram
# histogram_Probe arguments: (Stat Hash)
SELECT statisticStart, statisticEnd, bucketKey, bucketValue FROM (
    SELECT EQUIWIDTH_PROBE(45, 0, 25, 5)
    FROM (
        SELECT EQUIWIDTHHISTOGRAM(45, value, 5, 0, 25) FROM stream WINDOW TUMBLING(timestamp, size 5 sec)
    )
) INTO sinkStream;
----
0 5000 0 11
0 5000 1 0
0 5000 2 0
0 5000 3 0
0 5000 4 0
